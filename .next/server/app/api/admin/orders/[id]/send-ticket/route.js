"use strict";(()=>{var e={};e.id=7347,e.ids=[7347],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3498:e=>{e.exports=require("mysql2/promise")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{e.exports=require("querystring")},12412:e=>{e.exports=require("assert")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32213:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>x,serverHooks:()=>v,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>q});var s={};t.r(s),t.d(s,{POST:()=>c});var o=t(96559),i=t(48088),n=t(37719),a=t(32190),u=t(35426),p=t(7699),d=t(7462),l=t(91090);async function c(e,{params:r}){try{let t=await (0,u.getServerSession)(p.N);if(!t||"admin"!==t.user.role)return a.NextResponse.json({error:"No autorizado"},{status:401});let s=await r,o=parseInt(s.id,10);if(isNaN(o))return a.NextResponse.json({error:"ID de orden inv\xe1lido"},{status:400});let i=await (0,d.p)(o);if(!i)return a.NextResponse.json({error:"Orden no encontrada"},{status:404});if(!i.cliente_email||""===i.cliente_email.trim())return a.NextResponse.json({error:"El cliente no tiene un email registrado"},{status:400});let{includeImages:n=!1,customMessage:c=null,sendCopy:x=!1,copyEmail:m=null}=await e.json();console.log("Enviando ticket por email:",{ordenId:o,clienteEmail:i.cliente_email,codigoOrden:i.codigo_orden});let q=await (0,l.Rz)({order:i,includeImages:n,customMessage:c,sendCopy:x,copyEmail:m});if(!q.success)return console.error("Error enviando email:",q.error),a.NextResponse.json({error:q.error||"Error al enviar el email"},{status:500});return a.NextResponse.json({success:!0,message:`Ticket enviado exitosamente a ${i.cliente_email}`,emailId:q.emailId},{status:200})}catch(e){return console.error("Error en API de env\xedo de tickets:",e),a.NextResponse.json({error:e instanceof Error?e.message:"Error interno del servidor"},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/orders/[id]/send-ticket/route",pathname:"/api/admin/orders/[id]/send-ticket",filename:"route",bundlePath:"app/api/admin/orders/[id]/send-ticket/route"},resolvedPagePath:"/Users/santiserrano/Documents/GitHub/VipCleanersPos/app/api/admin/orders/[id]/send-ticket/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:q,serverHooks:v}=x;function g(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:q})}},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},37366:e=>{e.exports=require("dns")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{e.exports=require("zlib")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4243,3104,580,9526,7462,2380],()=>t(32213));module.exports=s})();