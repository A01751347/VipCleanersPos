(()=>{var e={};e.id=3103,e.ids=[3103],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3498:e=>{"use strict";e.exports=require("mysql2/promise")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56492:(e,r,o)=>{"use strict";o.r(r),o.d(r,{patchFetch:()=>m,routeModule:()=>u,serverHooks:()=>_,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>g});var t={};o.r(t),o.d(t,{GET:()=>d,POST:()=>c});var n=o(96559),s=o(48088),i=o(37719),a=o(32190),l=o(7462);async function c(e){try{let r;let{fullName:o,email:t,phone:n,shoesType:s,serviceType:i,deliveryMethod:c,bookingDate:d,address:u,requiresPickup:p}=await e.json();if(!o||!t||!n||!s||!i||!c||!d)return a.NextResponse.json({error:"Todos los campos son requeridos"},{status:400});let g=n.replace(/\D/g,"");if(g.length<10)return a.NextResponse.json({error:"El n\xfamero de tel\xe9fono debe tener al menos 10 d\xedgitos"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return a.NextResponse.json({error:"El correo electr\xf3nico no es v\xe1lido"},{status:400});let _=o.trim().split(" "),m=_.length>1?_.slice(1).join(" "):"",v=_[0],f=await (0,l.dd)(t);r=f?f.cliente_id:await (0,l.UU)(v,m,g,t);let x=new Date(d),h=new Date(x);h.setDate(h.getDate()+3);let b=null;p&&u&&(b=await (0,l.FR)(r,"pickup",u.street,u.number,u.interior||null,u.neighborhood||null,u.municipality||null,u.city,u.state,u.zipCode,"Direcci\xf3n de pickup",u.phone||g,o,u.instructions||null,u.timeWindowStart||null,u.timeWindowEnd||null));let{code:y}=await (0,l.bB)(r,parseInt(i),null,null,s,`Tipo de calzado: ${s}`,x,h,`M\xe9todo de entrega: ${c}`,b,p,p?x:null);return a.NextResponse.json({success:!0,bookingReference:y,message:"Reserva creada exitosamente"},{status:201})}catch(e){return console.error("Error en el endpoint de reserva:",e),a.NextResponse.json({error:"Error al procesar la solicitud"},{status:500})}}async function d(e){try{let{searchParams:r}=new URL(e.url),o=r.get("reference");if(console.log("Tracking request for reference:",o),!o)return a.NextResponse.json({error:"C\xf3digo de referencia es requerido"},{status:400});let t=o.trim().toUpperCase(),n=null,s=null;try{let e=await (0,l.do)(t);e&&(n=e,s="order",console.log("Found as order:",e.codigo_orden))}catch(e){console.log("Not found as order, trying reservation...")}if(!n)try{let e=await (0,l.p5)(t);e&&(n=e,s="reservation",console.log("Found as reservation:",e.codigo_reservacion))}catch(e){console.log("Not found as reservation either")}if(!n)return a.NextResponse.json({error:"No se encontr\xf3 ninguna orden o reserva con ese c\xf3digo"},{status:404});let i={id:n.id||n.orden_id||n.reservacion_id,type:s,codigo_orden:n.codigo_orden,codigo_reservacion:n.codigo_reservacion,booking_reference:n.codigo_orden||n.codigo_reservacion,cliente_nombre:n.cliente_nombre||n.nombre_cliente,cliente_apellidos:n.cliente_apellidos||n.apellidos_cliente,cliente_email:n.cliente_email||n.email,cliente_telefono:n.cliente_telefono||n.telefono,servicio_nombre:n.servicio_nombre||n.servicio_solicitado,marca:n.marca||n.marca_calzado,modelo:n.modelo||n.modelo_calzado,shoes_type:n.shoes_type||n.modelo_calzado,status:n.estado_actual||n.estado||"pendiente",estado:n.estado_actual||n.estado||"pendiente",fecha_recepcion:n.fecha_recepcion,fecha_reservacion:n.fecha_reservacion,created_at:n.created_at||n.fecha_creacion,delivery_method:n.delivery_method||n.metodo_entrega,total:n.total,estado_pago:n.estado_pago,..."order"===s&&{servicios:n.servicios,historial:n.historial},..."reservation"===s&&{notas:n.notas}};return console.log("Returning normalized response:",{id:i.id,type:i.type,status:i.status,reference:i.booking_reference}),a.NextResponse.json({success:!0,booking:i},{status:200})}catch(e){return console.error("Error al obtener la reserva:",e),a.NextResponse.json({error:"Error interno del servidor. Por favor, intenta nuevamente."},{status:500})}}let u=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/booking/route",pathname:"/api/booking",filename:"route",bundlePath:"app/api/booking/route"},resolvedPagePath:"/Users/santiserrano/Documents/GitHub/VipCleanersPos/app/api/booking/route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:p,workUnitAsyncStorage:g,serverHooks:_}=u;function m(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:g})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[4243,580,7462],()=>o(56492));module.exports=t})();