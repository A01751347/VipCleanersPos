(()=>{var e={};e.id=4305,e.ids=[4305],e.modules={3043:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>o.a,__next_app__:()=>c,pages:()=>u,routeModule:()=>m,tree:()=>d});var t=s(65239),i=s(48088),n=s(88170),o=s.n(n),a=s(30893),l={};for(let e in a)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);s.d(r,l);let d={children:["",{children:["unauthorized",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,58286)),"/Users/santiserrano/Documents/GitHub/VipCleanersPos/app/unauthorized/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,58014)),"/Users/santiserrano/Documents/GitHub/VipCleanersPos/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,u=["/Users/santiserrano/Documents/GitHub/VipCleanersPos/app/unauthorized/page.tsx"],c={require:s,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/unauthorized/page",pathname:"/unauthorized",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3498:e=>{"use strict";e.exports=require("mysql2/promise")},5216:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>u});var t=s(60687);s(43210);var i=s(99891),n=s(28559),o=s(32192),a=s(85814),l=s.n(a),d=s(82136);function u(){let{data:e}=(0,d.useSession)(),r=async()=>{await (0,d.signOut)({redirect:!0,callbackUrl:"/admin/login"})};return(0,t.jsxs)("div",{className:"min-h-screen flex flex-col justify-center items-center px-4 bg-[#f5f9f8]",children:[(0,t.jsxs)("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,t.jsx)(i.A,{size:40,className:"text-red-600"})}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-[#313D52] mb-4",children:"Acceso No Autorizado"}),(0,t.jsx)("p",{className:"text-[#6c7a89] mb-6",children:"No tienes permisos para acceder a esta secci\xf3n del sistema. Solo los administradores pueden acceder al panel de administraci\xf3n."}),e?.user&&(0,t.jsxs)("div",{className:"bg-[#f5f9f8] p-4 rounded-lg mb-6",children:[(0,t.jsx)("p",{className:"text-sm text-[#6c7a89] mb-2",children:"Usuario actual:"}),(0,t.jsx)("p",{className:"font-medium text-[#313D52]",children:e.user.name||e.user.email}),(0,t.jsxs)("p",{className:"text-xs text-[#6c7a89]",children:["Rol: ",e.user.role||"Sin rol asignado"]})]}),(0,t.jsx)("div",{className:"space-y-3",children:e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("button",{onClick:r,className:"w-full flex items-center justify-center px-4 py-3 bg-[#78f3d3] text-[#313D52] rounded-lg hover:bg-[#4de0c0] transition-colors font-medium",children:[(0,t.jsx)(n.A,{size:18,className:"mr-2"}),"Cerrar Sesi\xf3n"]}),(0,t.jsxs)(l(),{href:"/",className:"w-full inline-flex items-center justify-center px-4 py-3 border border-[#e0e6e5] text-[#6c7a89] rounded-lg hover:bg-[#f5f9f8] transition-colors",children:[(0,t.jsx)(o.A,{size:18,className:"mr-2"}),"Ir al Inicio"]})]}):(0,t.jsxs)(l(),{href:"/admin/login",className:"w-full inline-flex items-center justify-center px-4 py-3 bg-[#78f3d3] text-[#313D52] rounded-lg hover:bg-[#4de0c0] transition-colors font-medium",children:[(0,t.jsx)(n.A,{size:18,className:"mr-2"}),"Iniciar Sesi\xf3n"]})})]}),(0,t.jsx)("div",{className:"mt-8 text-center text-sm text-[#6c7a89]",children:(0,t.jsx)("p",{children:"Si crees que esto es un error, contacta al administrador del sistema."})})]})}},7699:(e,r,s)=>{"use strict";s.d(r,{N:()=>l});var t=s(13581),i=s(7462),n=s(85663);async function o(e){try{let r=e.toLowerCase().trim(),s=`
      SELECT 
        u.usuario_id, 
        u.email, 
        u.password, 
        u.rol, 
        u.activo,
        e.nombre,
        e.apellidos
      FROM usuarios u
      LEFT JOIN empleados e ON u.usuario_id = e.usuario_id
      WHERE u.email = ? AND u.activo = TRUE
    `,t=await (0,i.eW)({query:s,values:[r]});if(0===t.length)return null;return t[0]}catch(e){return console.error("Error al obtener usuario por email:",e),null}}async function a(e,r){try{return await (0,n.UD)(e,r)}catch(e){return console.error("Error al verificar la contrase\xf1a:",e),!1}}let l={providers:[(0,t.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let r=await o(e.email);if(!r||!await a(e.password,r.password))return null;return{id:r.usuario_id.toString(),name:r.nombre?`${r.nombre} ${r.apellidos||""}`.trim():r.email,email:r.email,role:r.rol}}catch(e){return console.error("\uD83D\uDCA5 Error en autorizaci\xf3n:",e),null}}})],pages:{signIn:"/admin/login",error:"/admin/login"},session:{strategy:"jwt",maxAge:2592e3},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.role=r.role,e.id=r.id),e),session:async({session:e,token:r})=>(e.user&&(e.user.role=r.role,e.user.id=r.id),e),redirect:async({url:e,baseUrl:r})=>e.includes("/admin/login")||e===r?`${r}/admin`:e.startsWith("/")?`${r}${e}`:e.startsWith(r)?e:`${r}/admin`},debug:!1,secret:"genera_un_secreto_aleatorio_largo"}},8392:(e,r,s)=>{Promise.resolve().then(s.t.bind(s,86346,23)),Promise.resolve().then(s.t.bind(s,27924,23)),Promise.resolve().then(s.t.bind(s,35656,23)),Promise.resolve().then(s.t.bind(s,40099,23)),Promise.resolve().then(s.t.bind(s,38243,23)),Promise.resolve().then(s.t.bind(s,28827,23)),Promise.resolve().then(s.t.bind(s,62763,23)),Promise.resolve().then(s.t.bind(s,97173,23))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21544:(e,r,s)=>{Promise.resolve().then(s.t.bind(s,16444,23)),Promise.resolve().then(s.t.bind(s,16042,23)),Promise.resolve().then(s.t.bind(s,88170,23)),Promise.resolve().then(s.t.bind(s,49477,23)),Promise.resolve().then(s.t.bind(s,29345,23)),Promise.resolve().then(s.t.bind(s,12089,23)),Promise.resolve().then(s.t.bind(s,46577,23)),Promise.resolve().then(s.t.bind(s,31307,23))},21632:(e,r,s)=>{"use strict";s.d(r,{default:()=>n});var t=s(60687),i=s(82136);function n({children:e,session:r}){return(0,t.jsx)(i.SessionProvider,{session:r,children:e})}},25971:(e,r,s)=>{Promise.resolve().then(s.bind(s,5216))},28354:e=>{"use strict";e.exports=require("util")},28559:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(62688).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31150:(e,r,s)=>{"use strict";s.d(r,{default:()=>t});let t=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/santiserrano/Documents/GitHub/VipCleanersPos/components/SessionProvider.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/santiserrano/Documents/GitHub/VipCleanersPos/components/SessionProvider.tsx","default")},32192:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(62688).A)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]])},33873:e=>{"use strict";e.exports=require("path")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},58014:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>a});var t=s(37413),i=s(35426),n=s(7699),o=s(31150);async function a({children:e}){let r=await (0,i.getServerSession)(n.N);return console.log("\uD83C\uDFE0 Root Layout - Server session:",!!r,r?.user?.role),(0,t.jsx)("html",{lang:"es",children:(0,t.jsx)("body",{children:(0,t.jsx)(o.default,{session:r,children:e})})})}},58286:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>t});let t=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/santiserrano/Documents/GitHub/VipCleanersPos/app/unauthorized/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/santiserrano/Documents/GitHub/VipCleanersPos/app/unauthorized/page.tsx","default")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67362:(e,r,s)=>{Promise.resolve().then(s.bind(s,31150))},72827:(e,r,s)=>{Promise.resolve().then(s.bind(s,58286))},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},85514:(e,r,s)=>{Promise.resolve().then(s.bind(s,21632))},94735:e=>{"use strict";e.exports=require("events")},99891:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(62688).A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])}};var r=require("../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4243,3104,4278,3889,7462],()=>s(3043));module.exports=t})();